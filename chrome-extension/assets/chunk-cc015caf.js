import{s as l,M as a,B as y,c as I,E as w,S as m}from"./chunk-fe7244a2.js";import{T as b,S as v,C as K,a as M,d as k}from"./chunk-8e035f36.js";var g;(s=>{function e(r,n){return l.sendMessage({type:a.Notification,reciver:r,payload:{type:"success",...n}})}s.success=e;function o(r,n){return l.sendMessage({type:a.Notification,reciver:r,payload:{type:"error",...n}})}s.error=o;function t(r,n){return l.sendMessage({type:a.Notification,reciver:r,payload:{type:"info",...n}})}s.info=t})(g||(g={}));const i=g;y.runtime.onInstalled.addListener(()=>{y.contextMenus.create({id:"KubespiderMenu",title:"Send to Kubespider",contexts:["all"]})});y.contextMenus.onClicked.addListener(async(s,e)=>{if(s.menuItemId==="KubespiderMenu"){const o=(e==null?void 0:e.id)||await b.getCurrentTabId();let t=s.linkUrl;if((t===""||t==null)&&(t=e==null?void 0:e.url),t===""||t==null)return;const{server:r,token:n,captureCookies:d}=await v.read(),p=d?await K.getAll(t):void 0;if(!r||r===""){i.error(o,{title:"Kubespider",content:"Please set server address first!"});return}const f=await i.info(o,{title:"Kubespider",content:`${t} is downloading...`,delay:-1}),{messageId:c}=f.payload,u=await M(k(r,t,void 0,p,n));u.status===200?i.success(o,{id:c,title:"Kubespider",content:`${t} download success`}):i.error(o,{id:c,title:"Kubespider",content:`${t} download failed, ${u.body}`})}});I.addListener(a.Download,async s=>{const{dataSource:e,path:o}=s,{server:t,token:r,captureCookies:n}=await v.read();if(!t||t==="")return w("Please set server address first");const d=await b.getCurrentTabId(),p=n?await K.getAll(e):void 0,f=await i.info(d,{title:"Kubespider",content:`${e} is downloading...`,delay:-1}),{messageId:c}=f.payload,u=await M(k(t,e,o,p,r));return u.status===200?(i.success(d,{id:c,title:"Kubespider",content:`${e} download success`}),m()):(i.error(d,{id:c,title:"Kubespider",content:`${u.body}`}),w())});I.addListener(a.Notification,async s=>{let{tabId:e}=s;return e?m():(e=await b.getCurrentTabId(),e===-1?w("No active tab"):l.sendMessage({type:a.Notification,reciver:e,payload:s}))});
