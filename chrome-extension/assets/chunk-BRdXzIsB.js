import{s as u,M as a,B as y,c as I,E as w,S as m}from"./chunk-B9e8ng1t.js";import{T as b,S as v,C as K,a as M,d as k}from"./chunk-a4rd3Jte.js";var g;(s=>{function e(n,r){return u.sendMessage({type:a.Notification,reciver:n,payload:{type:"success",...r}})}s.success=e;function o(n,r){return u.sendMessage({type:a.Notification,reciver:n,payload:{type:"error",...r}})}s.error=o;function t(n,r){return u.sendMessage({type:a.Notification,reciver:n,payload:{type:"info",...r}})}s.info=t})(g||(g={}));const i=g;y.runtime.onInstalled.addListener(()=>{y.contextMenus.create({id:"KubespiderMenu",title:"Send to Kubespider",contexts:["all"]})});y.contextMenus.onClicked.addListener(async(s,e)=>{if(s.menuItemId==="KubespiderMenu"){const o=(e==null?void 0:e.id)||await b.getCurrentTabId();let t=s.selectionText;if((t===""||t==null)&&(t=s.linkUrl),(t===""||t==null)&&(t=e==null?void 0:e.url),t===""||t==null)return;const{server:n,token:r,captureCookies:d}=await v.read(),p=d?await K.getAll(t):void 0;if(!n||n===""){i.error(o,{title:"Kubespider",content:"Please set server address first!"});return}const f=await i.info(o,{title:"Kubespider",content:`${t} is downloading...`,delay:-1}),{messageId:c}=f.payload,l=await M(k(n,t,void 0,p,r));l.status===200?i.success(o,{id:c,title:"Kubespider",content:`${t} download success`}):i.error(o,{id:c,title:"Kubespider",content:`${t} download failed, ${l.body}`})}});I.addListener(a.Download,async s=>{const{dataSource:e,path:o}=s,{server:t,token:n,captureCookies:r}=await v.read();if(!t||t==="")return w("Please set server address first");const d=await b.getCurrentTabId(),p=r?await K.getAll(e):void 0,f=await i.info(d,{title:"Kubespider",content:`${e} is downloading...`,delay:-1}),{messageId:c}=f.payload,l=await M(k(t,e,o,p,n));return l.status===200?(i.success(d,{id:c,title:"Kubespider",content:`${e} download success`}),m()):(i.error(d,{id:c,title:"Kubespider",content:`${e} download failed, ${l.body}`}),w())});I.addListener(a.Notification,async s=>{let{tabId:e}=s;return e?m():(e=await b.getCurrentTabId(),e===-1?w("No active tab"):u.sendMessage({type:a.Notification,reciver:e,payload:s}))});
